{% extends "base.html" %}
{% block title %}Register{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6 col-lg-5">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h1 class="h5 mb-3">Create an account</h1>

        <div id="alertBox" class="alert d-none" role="alert"></div>

        <form id="registerForm">
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input id="email" type="email" class="form-control" autocomplete="email" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Password</label>
            <input id="password" type="password" class="form-control" autocomplete="new-password" required>
            <div class="form-text">Use at least 12 characters (recommended).</div>
          </div>

          <button class="btn btn-primary w-100" type="submit">Register</button>
        </form>

        <hr class="my-4">
        <p class="text-muted mb-0 small">
          This page calls <code>POST /auth/register</code> using JSON.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
const form = document.getElementById("registerForm");
const alertBox = document.getElementById("alertBox");

function showAlert(type, msg) {
  alertBox.className = "alert alert-" + type;
  alertBox.textContent = msg;
  alertBox.classList.remove("d-none");
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  alertBox.classList.add("d-none");

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;

  try {
    const res = await fetch("/auth/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json().catch(() => null);

    if (!res.ok) {
      const msg = data?.error?.message || "Registration failed";
      showAlert("danger", msg);
      return;
    }

    showAlert("success", "Registered successfully for " + data.data.email);
    form.reset();

  } catch (err) {
    showAlert("danger", "Network error. Check the server is running.");
  }
});
</script>
{% endblock %}